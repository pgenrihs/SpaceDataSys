<!doctype html>
<html>
<head>
    <title>Skatīt failu - {{ filename }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h1>🛰️ Fails: {{ filename }}</h1>
    <a href="{{ url_for('index') }}">⬅️ Atpakaļ uz galveno lapu</a>

    {% for hdu in hdu_views %}

    <hr>
    <h2>HDU {{ hdu.index }} - {{ hdu.name }}</h2>
    <p><strong>HDU tips:</strong> {{ hdu.type }} | <strong>Izmērs:</strong> {{ hdu.shape }}</p>

    {% if hdu.images %}
    <h3>🖼️ Attēla priekšskatījums</h3>

    <label for="cmapSelect{{ hdu.index }}">🎨 Krāsu karte:</label>
    <select class="cmap-select" data-hdu="{{ hdu.index }}">
        {% for cmap in hdu.images.keys() %}
            <option value="{{ cmap }}">{{ cmap }}</option>
        {% endfor %}
    </select>

    <img id="imgPreview{{ hdu.index }}" src="data:image/png;base64,{{ hdu.images['gray'] }}"
        data-hdu="{{ hdu.index }}"
        {% for cmap, b64 in hdu.images.items() %}
        data-{{ cmap }}="data:image/png;base64,{{ b64 }}"
        {% endfor %}>
    {% endif %}

    <script>
    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll(".cmap-select").forEach(function (select) {
            select.addEventListener("change", function () {
                const hduIndex = this.dataset.hdu;
                const selectedCmap = this.value;
                const img = document.querySelector(`#imgPreview${hduIndex}`);
                const newSrc = img.dataset[selectedCmap];  // pulls from data-gray, data-viridis, etc.
                img.src = newSrc;
            });
        });
    });
    </script>

    {% if hdu.table %}
        {% if hdu.table.__class__.__name__ == 'Table' %}
        <h3>📊 Tabulas priekšskatījums (Pirmās 5 kolonnas)</h3>
        <table border="1">
            <tr>
                {% for col in hdu.table.colnames %}
                <th>{{ col }}</th>
                {% endfor %}
            </tr>
            {% for row in hdu.table %}
            <tr>
                {% for col in hdu.table.colnames %}
                <td>{{ row[col] }}</td>
                {% endfor %}
            </tr>
            {% endfor %}
        </table>
        {% else %}
        <p>{{ hdu.table }}</p>
        {% endif %}
    {% endif %}
    {% endfor %}


</body>
</html>
